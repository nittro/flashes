_context.invoke("Nittro.Extras.Flashes",function(DOM,Arrays,CSSTransitions){var Service=_context.extend(function(options){this._={options:Arrays.mergeTree({},Service.defaults,options),globalHolder:DOM.create("div",{"class":"nittro-flash-global-holder"})},"string"==typeof this._.options.layer?this._.options.layer=DOM.getById(this._.options.layer):this._.options.layer||(this._.options.layer=document.body),this._.options.layer.appendChild(this._.globalHolder),this._.options.positioning||(this._.options.positioning=Service.basicPositioning),"string"==typeof this._.options.positioningOrder&&(this._.options.positioningOrder=this._.options.positioningOrder.split(/\s*,\s*|\s+/g)),this._.options.classes||(this._.options.classes=DOM.getData(this._.options.layer,"flash-classes")),this._removeStatic()},{STATIC:{defaults:{layer:null,minMargin:20,positioning:null,positioningOrder:"above,rightOf,below,leftOf",classes:null},basicPositioning:{above:function(target,elem,minMargin,force){var res={left:target.left+(target.width-elem.width)/2,top:target.top-elem.height};if(force||target.top>elem.height+minMargin&&res.left>0&&res.left+elem.width<window.innerWidth)return res},below:function(target,elem,minMargin,force){var res={left:target.left+(target.width-elem.width)/2,top:target.bottom};if(force||target.bottom+elem.height+minMargin<window.innerHeight&&res.left>0&&res.left+elem.width<window.innerWidth)return res},leftOf:function(target,elem,minMargin,force){var res={left:target.left-elem.width,top:target.top+(target.height-elem.height)/2};if(force||target.left>elem.width+minMargin&&res.top>0&&res.top+elem.height<window.innerHeight)return res},rightOf:function(target,elem,minMargin,force){var res={left:target.right,top:target.top+(target.height-elem.height)/2};if(force||target.right+elem.width+minMargin<window.innerWidth&&res.top>0&&res.top+elem.height<window.innerHeight)return res}}},add:function(content,type,target,rich){type||(type="info");var elem=DOM.create("div",{"class":"nittro-flash nittro-flash-"+type});DOM.setData(elem,"flash-dynamic",!0),target&&"string"==typeof target&&(target=DOM.getById(target));var classes=target?DOM.getData(target,"flash-classes"):this._.options.classes,inline=!!target&&DOM.getData(target,"flash-inline");if(classes&&DOM.addClass(elem,classes.replace(/%type%/g,type)),rich?DOM.html(elem,content):(DOM.addClass(elem,"nittro-flash-plain"),elem.textContent=content),inline)return target.appendChild(elem),void this._show(elem,"inline");if(target){DOM.setStyle(elem,"opacity",0),this._.options.layer.appendChild(elem);var position,fixed=this._hasFixedParent(target),elemRect=this._getRect(elem),targetRect=this._getRect(target),style={},order=this._.options.positioningOrder,force=!1,positionName=DOM.getData(target,"flash-placement");if(fixed&&(style.position="fixed"),positionName){var m=positionName.match(/^(.+?)(!)?(!)?$/);force=!!m[3],m[2]?order=[m[1]]:order.unshift(m[1])}for(var i=0;i<order.length&&(positionName=order[i],!(position=this._.options.positioning[positionName].call(null,targetRect,elemRect,this._.options.minMargin,force)));i++);if(position)return style.left=position.left,style.top=position.top,fixed||(style.left+=window.pageXOffset,style.top+=window.pageYOffset),style.left+="px",style.top+="px",style.opacity="",DOM.setStyle(elem,style),void this._show(elem,positionName);DOM.setStyle(elem,"opacity","")}this._.globalHolder.appendChild(elem),this._show(elem,"global")},_show:function(elem,position){DOM.addClass(elem,"nittro-flash-show nittro-flash-"+position),window.setTimeout(function(){window.pageYOffset;DOM.removeClass(elem,"nittro-flash-show"),this._bindHide(elem)}.bind(this),1)},_bindHide:function(elem){var hide=function(){DOM.removeListener(document,"mousemove",hide),DOM.removeListener(document,"mousedown",hide),DOM.removeListener(document,"keydown",hide),DOM.removeListener(document,"touchstart",hide);var timeout=Math.max(2e3,Math.round(elem.textContent.split(/\s+/).length/.003));window.setTimeout(function(){DOM.addClass(elem,"nittro-flash-hide"),CSSTransitions.run(elem).then(function(){elem.parentNode.removeChild(elem)})},timeout)}.bind(this);DOM.addListener(document,"mousemove",hide),DOM.addListener(document,"mousedown",hide),DOM.addListener(document,"keydown",hide),DOM.addListener(document,"touchstart",hide)},_removeStatic:function(){DOM.getByClassName("nittro-flash").forEach(function(elem){DOM.getData(elem,"flash-dynamic")||this._bindHide(elem)}.bind(this))},_hasFixedParent:function(elem){do{if("fixed"===elem.style.position)return!0;elem=elem.offsetParent}while(elem&&elem!==document.documentElement&&elem!==document.body);return!1},_getRect:function(elem){var rect=elem.getBoundingClientRect();return{left:rect.left,top:rect.top,right:rect.right,bottom:rect.bottom,width:"width"in rect?rect.width:rect.right-rect.left,height:"height"in rect?rect.height:rect.bottom-rect.top}}});_context.register(Service,"Service")},{DOM:"Utils.DOM",Arrays:"Utils.Arrays",CSSTransitions:"Utils.CSSTransitions"});